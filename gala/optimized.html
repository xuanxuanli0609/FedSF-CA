<!DOCTYPE html>
<!-- Generated by Cython 3.0.10 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: optimized.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.10</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="optimized.c">optimized.c</a></p>
<div class="cython"><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: import numpy as np</pre>
<pre class='cython code score-16 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_numpy, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: cimport numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-78" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">004</span>: def despeckle_watershed(ws, in_place=True):</pre>
<pre class='cython code score-78 '>/* Python wrapper */
static PyObject *__pyx_pw_4gala_9optimized_1despeckle_watershed(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_4gala_9optimized_despeckle_watershed, " Function to clean up dots in an initial oversegmentation. \n\n    If all instances of a label are surrounded by one second label, then we\n    change those pixels to the second label. Useful for dealing with tiny dots\n    when running watershed on un-thresholded probability maps. Assumes all\n    labels appear only on one contiguous blob.\n\n    Parameters\n    ----------\n    ws : ndarray of 2 or 3 dimensions\n        an image or stack of images to be cleaned up. If it is a stack, each\n        plane is considered separately. \n    in_place : boolean, optional\n        whether to modify the original images or create a copy. \n        defaults to True.\n\n    Returns\n    -------\n    out : ndarray, same shape and type as `ws`\n        the original image with all holes filled in their surrounding label\n    ");
static PyMethodDef __pyx_mdef_4gala_9optimized_1despeckle_watershed = {"despeckle_watershed", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_4gala_9optimized_1despeckle_watershed, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_4gala_9optimized_despeckle_watershed};
static PyObject *__pyx_pw_4gala_9optimized_1despeckle_watershed(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ws = 0;
  PyObject *__pyx_v_in_place = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("despeckle_watershed (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ws,&amp;__pyx_n_s_in_place,0};
  PyObject* values[2] = {0,0};
    values[1] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ws)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_in_place);
          if (value) { values[1] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "despeckle_watershed") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ws = values[0];
    __pyx_v_in_place = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("despeckle_watershed", 0, 1, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.despeckle_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4gala_9optimized_despeckle_watershed(__pyx_self, __pyx_v_ws, __pyx_v_in_place);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4gala_9optimized_despeckle_watershed(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ws, PyObject *__pyx_v_in_place) {
  int __pyx_v_ii;
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ws);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.despeckle_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ws);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__24 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_ws, __pyx_n_s_in_place, __pyx_n_s_ii);<span class='error_goto'> if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__24);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__24);
  __pyx_codeobj__25 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gala_optimized_pyx, __pyx_n_s_despeckle_watershed, 4, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_4gala_9optimized_1despeckle_watershed, 0, __pyx_n_s_despeckle_watershed, NULL, __pyx_n_s_gala_optimized, __pyx_d, ((PyObject *)__pyx_codeobj__25));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_7, __pyx_tuple__26);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_despeckle_watershed, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject *)Py_True));<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
</pre><pre class="cython line score-0">&#xA0;<span class="">005</span>:     """ Function to clean up dots in an initial oversegmentation.</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>:     If all instances of a label are surrounded by one second label, then we</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>:     change those pixels to the second label. Useful for dealing with tiny dots</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>:     when running watershed on un-thresholded probability maps. Assumes all</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>:     labels appear only on one contiguous blob.</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>:     ws : ndarray of 2 or 3 dimensions</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>:         an image or stack of images to be cleaned up. If it is a stack, each</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>:         plane is considered separately.</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>:     in_place : boolean, optional</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>:         whether to modify the original images or create a copy.</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>:         defaults to True.</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:     out : ndarray, same shape and type as `ws`</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>:         the original image with all holes filled in their surrounding label</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>:     cdef int ii</pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">027</span>:     if not in_place: ws = ws.copy()</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_in_place); if (unlikely((__pyx_t_1 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 27, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_ws, __pyx_t_3);
    __pyx_t_3 = 0;
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">028</span>:     if ws.ndim == 3:</pre>
<pre class='cython code score-5 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyInt_BoolEqObjC</span>(__pyx_t_3, __pyx_int_3, 3, 0)); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">029</span>:         for ii in range(ws.shape[0]):</pre>
<pre class='cython code score-13 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_4); if (unlikely((__pyx_t_7 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 29, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_8 = __pyx_t_7;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_8; __pyx_t_6+=1) {
      __pyx_v_ii = __pyx_t_6;
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">030</span>:             ws[ii,:,:] = _despeckle_2d_watershed(ws[ii,:,:])</pre>
<pre class='cython code score-43 '>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ii);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_ws, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_t_4, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __pyx_f_4gala_9optimized__despeckle_2d_watershed(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL; __pyx_t_9.data = NULL;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ii);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
      if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>;
      __pyx_t_3 = 0;
      if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_ws, __pyx_t_5, __pyx_t_4) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">031</span>:         return ws</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ws);
    __pyx_r = __pyx_v_ws;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">032</span>:     else:</pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">033</span>:         return _despeckle_2d_watershed(ws)</pre>
<pre class='cython code score-3 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_v_ws, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
    __pyx_t_4 = __pyx_f_4gala_9optimized__despeckle_2d_watershed(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
    __pyx_t_9.memview = NULL; __pyx_t_9.data = NULL;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">034</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">036</span>: cdef _despeckle_2d_watershed(long[:,:] ws):</pre>
<pre class='cython code score-10 '>static PyObject *__pyx_f_4gala_9optimized__despeckle_2d_watershed(__Pyx_memviewslice __pyx_v_ws) {
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_i_offset;
  int __pyx_v_j_offset;
  int __pyx_v_label;
  PyObject *__pyx_v_neighborhoods = NULL;
  PyObject *__pyx_v_replacements = NULL;
  PyObject *__pyx_v_neighbors = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._despeckle_2d_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_neighborhoods);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_replacements);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_neighbors);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">037</span>:     """ workhorse function for despeckle_watershed, see its documentation """</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:     cdef int ii, jj, i_offset, j_offset, label</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">039</span>:     neighborhoods = {}</pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_neighborhoods = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">040</span>:     replacements = {}</pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_replacements = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">041</span>:     for ii in range(ws.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_ws.shape[0]);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_ii = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">042</span>:         for jj in range(ws.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_ws.shape[1]);
    __pyx_t_6 = __pyx_t_5;
    for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_jj = __pyx_t_7;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">043</span>:             if ws[ii,jj] not in neighborhoods:</pre>
<pre class='cython code score-7 '>      __pyx_t_8 = __pyx_v_ii;
      __pyx_t_9 = __pyx_v_jj;
      __pyx_t_10 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 1;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
      if (unlikely(__pyx_t_10 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
        <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L1_error)</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_8 * __pyx_v_ws.strides[0]) ) + __pyx_t_9 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_11 = (<span class='pyx_c_api'>__Pyx_PyDict_ContainsTF</span>(__pyx_t_1, __pyx_v_neighborhoods, Py_NE)); if (unlikely((__pyx_t_11 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_11) {
/* … */
      }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">044</span>:                 neighborhoods[ws[ii,jj]] = []</pre>
<pre class='cython code score-16 '>        __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_9 = __pyx_v_ii;
        __pyx_t_8 = __pyx_v_jj;
        __pyx_t_10 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_ws.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_v_ws.shape[1];
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 1;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
        if (unlikely(__pyx_t_10 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
          <span class='error_goto'>__PYX_ERR(0, 44, __pyx_L1_error)</span>
        }
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_9 * __pyx_v_ws.strides[0]) ) + __pyx_t_8 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        if (unlikely((<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_neighborhoods, __pyx_t_12, __pyx_t_1) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 44, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">045</span>:             for i_offset in [-1, 0, 1]:</pre>
<pre class='cython code score-19 '>      __pyx_t_1 = __pyx_tuple__11; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      __pyx_t_13 = 0;
      for (;;) {
        if (__pyx_t_13 &gt;= 3) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_13); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_13++; if (unlikely((0 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 45, __pyx_L1_error)</span>
        #else
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_1, __pyx_t_13); __pyx_t_13++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 45, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        #endif
        __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_12); if (unlikely((__pyx_t_10 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 45, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_v_i_offset = __pyx_t_10;
/* … */
        __pyx_L8_continue:;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
  }
/* … */
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_int_neg_1, __pyx_int_0, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 45, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>:                 if i_offset+ii &lt; 0 or i_offset+ii &gt;= ws.shape[0]:</pre>
<pre class='cython code score-0 '>        __pyx_t_14 = ((__pyx_v_i_offset + __pyx_v_ii) &lt; 0);
        if (!__pyx_t_14) {
        } else {
          __pyx_t_11 = __pyx_t_14;
          goto __pyx_L11_bool_binop_done;
        }
        __pyx_t_14 = ((__pyx_v_i_offset + __pyx_v_ii) &gt;= (__pyx_v_ws.shape[0]));
        __pyx_t_11 = __pyx_t_14;
        __pyx_L11_bool_binop_done:;
        if (__pyx_t_11) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">047</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L8_continue;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">048</span>:                 for j_offset in [-1, 0, 1]:</pre>
<pre class='cython code score-14 '>        __pyx_t_12 = __pyx_tuple__11; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
        __pyx_t_15 = 0;
        for (;;) {
          if (__pyx_t_15 &gt;= 3) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_16 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_12, __pyx_t_15); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_16); __pyx_t_15++; if (unlikely((0 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 48, __pyx_L1_error)</span>
          #else
          __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_12, __pyx_t_15); __pyx_t_15++;<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 48, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
          #endif
          __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_16); if (unlikely((__pyx_t_10 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 48, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
          __pyx_v_j_offset = __pyx_t_10;
/* … */
          __pyx_L13_continue:;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>:                     if j_offset+jj &lt; 0 or j_offset+jj &gt;= ws.shape[1]:</pre>
<pre class='cython code score-0 '>          __pyx_t_14 = ((__pyx_v_j_offset + __pyx_v_jj) &lt; 0);
          if (!__pyx_t_14) {
          } else {
            __pyx_t_11 = __pyx_t_14;
            goto __pyx_L16_bool_binop_done;
          }
          __pyx_t_14 = ((__pyx_v_j_offset + __pyx_v_jj) &gt;= (__pyx_v_ws.shape[1]));
          __pyx_t_11 = __pyx_t_14;
          __pyx_L16_bool_binop_done:;
          if (__pyx_t_11) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>:                         continue</pre>
<pre class='cython code score-0 '>            goto __pyx_L13_continue;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">051</span>:                     label = ws[ii+i_offset, jj+j_offset]</pre>
<pre class='cython code score-2 '>          __pyx_t_8 = (__pyx_v_ii + __pyx_v_i_offset);
          __pyx_t_9 = (__pyx_v_jj + __pyx_v_j_offset);
          __pyx_t_10 = -1;
          if (__pyx_t_8 &lt; 0) {
            __pyx_t_8 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 0;
          } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
          if (__pyx_t_9 &lt; 0) {
            __pyx_t_9 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 1;
          } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
          if (unlikely(__pyx_t_10 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
            <span class='error_goto'>__PYX_ERR(0, 51, __pyx_L1_error)</span>
          }
          __pyx_v_label = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_8 * __pyx_v_ws.strides[0]) ) + __pyx_t_9 * __pyx_v_ws.strides[1]) )));
</pre><pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>:                     if label == ws[ii,jj] or label in neighborhoods[ws[ii,jj]]:</pre>
<pre class='cython code score-15 '>          __pyx_t_9 = __pyx_v_ii;
          __pyx_t_8 = __pyx_v_jj;
          __pyx_t_10 = -1;
          if (__pyx_t_9 &lt; 0) {
            __pyx_t_9 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 0;
          } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
          if (__pyx_t_8 &lt; 0) {
            __pyx_t_8 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 1;
          } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
          if (unlikely(__pyx_t_10 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
            <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L1_error)</span>
          }
          __pyx_t_14 = (__pyx_v_label == (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_9 * __pyx_v_ws.strides[0]) ) + __pyx_t_8 * __pyx_v_ws.strides[1]) ))));
          if (!__pyx_t_14) {
          } else {
            __pyx_t_11 = __pyx_t_14;
            goto __pyx_L19_bool_binop_done;
          }
          __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
          __pyx_t_8 = __pyx_v_ii;
          __pyx_t_9 = __pyx_v_jj;
          __pyx_t_10 = -1;
          if (__pyx_t_8 &lt; 0) {
            __pyx_t_8 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 0;
          } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
          if (__pyx_t_9 &lt; 0) {
            __pyx_t_9 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 1;
          } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
          if (unlikely(__pyx_t_10 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
            <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L1_error)</span>
          }
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_8 * __pyx_v_ws.strides[0]) ) + __pyx_t_9 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_neighborhoods, __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_t_14 = (<span class='pyx_c_api'>__Pyx_PySequence_ContainsTF</span>(__pyx_t_16, __pyx_t_18, Py_EQ)); if (unlikely((__pyx_t_14 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
          __pyx_t_11 = __pyx_t_14;
          __pyx_L19_bool_binop_done:;
          if (__pyx_t_11) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:                         continue</pre>
<pre class='cython code score-0 '>            goto __pyx_L13_continue;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">054</span>:                     neighborhoods[ws[ii,jj]].append(label)</pre>
<pre class='cython code score-13 '>          __pyx_t_9 = __pyx_v_ii;
          __pyx_t_8 = __pyx_v_jj;
          __pyx_t_10 = -1;
          if (__pyx_t_9 &lt; 0) {
            __pyx_t_9 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 0;
          } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
          if (__pyx_t_8 &lt; 0) {
            __pyx_t_8 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 1;
          } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
          if (unlikely(__pyx_t_10 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
            <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
          }
          __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_9 * __pyx_v_ws.strides[0]) ) + __pyx_t_8 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
          __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_neighborhoods, __pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
          __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_t_16, __pyx_t_18);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 54, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">055</span>:     for label, neighbors in neighborhoods.iteritems():</pre>
<pre class='cython code score-10 '>  __pyx_t_2 = 0;
  __pyx_t_12 = __Pyx_dict_iterator(__pyx_v_neighborhoods, 1, __pyx_n_s_iteritems, (&amp;__pyx_t_3), (&amp;__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 55, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  __pyx_t_1 = __pyx_t_12;
  __pyx_t_12 = 0;
  while (1) {
    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &amp;__pyx_t_2, &amp;__pyx_t_12, &amp;__pyx_t_18, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_7 == 0)) break;
    if (unlikely(__pyx_t_7 == -1)) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_12); if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_v_label = __pyx_t_7;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_neighbors, __pyx_t_18);
    __pyx_t_18 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         if len(neighbors) == 1:</pre>
<pre class='cython code score-5 '>    __pyx_t_5 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_neighbors);<span class='error_goto'> if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 56, __pyx_L1_error)</span>
    __pyx_t_11 = (__pyx_t_5 == 1);
    if (__pyx_t_11) {
/* … */
      goto __pyx_L25;
    }
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>:             replacements[label] = neighbors[0]</pre>
<pre class='cython code score-11 '>      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_neighbors, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      if (unlikely((<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_replacements, __pyx_t_12, __pyx_t_18) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">058</span>:         else:</pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>:             replacements[label] = label</pre>
<pre class='cython code score-12 '>    /*else*/ {
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 59, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 59, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      if (unlikely((<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_replacements, __pyx_t_12, __pyx_t_18) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 59, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    }
    __pyx_L25:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:     for ii in range(ws.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_ws.shape[0]);
  __pyx_t_2 = __pyx_t_3;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_2; __pyx_t_4+=1) {
    __pyx_v_ii = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:         for jj in range(ws.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_ws.shape[1]);
    __pyx_t_6 = __pyx_t_5;
    for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_jj = __pyx_t_7;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>:             ws[ii,jj] = replacements[ws[ii,jj]]</pre>
<pre class='cython code score-17 '>      __pyx_t_8 = __pyx_v_ii;
      __pyx_t_9 = __pyx_v_jj;
      __pyx_t_10 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 1;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
      if (unlikely(__pyx_t_10 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
        <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_8 * __pyx_v_ws.strides[0]) ) + __pyx_t_9 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_replacements, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 62, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_20 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_18); if (unlikely((__pyx_t_20 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
      __pyx_t_9 = __pyx_v_ii;
      __pyx_t_8 = __pyx_v_jj;
      __pyx_t_10 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_ws.shape[0])) __pyx_t_10 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_10 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[1])) __pyx_t_10 = 1;
      if (unlikely(__pyx_t_10 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
        <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span>
      }
      *((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_9 * __pyx_v_ws.strides[0]) ) + __pyx_t_8 * __pyx_v_ws.strides[1]) )) = __pyx_t_20;
    }
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:     return ws</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_18 = __pyx_memoryview_fromslice(__pyx_v_ws, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 63, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  __pyx_r = __pyx_t_18;
  __pyx_t_18 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">064</span>: </pre>
<pre class="cython line score-133" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>: def flood_fill(im, start, acceptable, limits=None, raveled=False):</pre>
<pre class='cython code score-133 '>/* Python wrapper */
static PyObject *__pyx_pw_4gala_9optimized_3flood_fill(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_4gala_9optimized_2flood_fill, " Find all connected points in a 3D volume.\n\n    Starting from a given point, this function floods into all adjacent\n    points that have an acceptable label.\n\n    Parameters\n    ----------\n    im : 3D ndarray of longs\n        This is the volume in which the flood fill will fill. Each voxel's\n        value is its label and its indices are its position.\n    start : 1D ndarray of longs\n        This gives the position of the first point from which the flood fill \n        will begin. must be length 3.\n    acceptable : 1D ndarray of longs\n        As the flood fills, each pixel is checked to see if its value is in\n        this list. the flood fill continues into that pixel iff it is.\n    limits : 2D ndarray of longs, optional\n        Allows the calling function specify an outer bound for the flood fill.\n        Given as a matrix where each row represents a dimension in im and the\n        first column is the lower bound and the second column is the upper.\n        Defaults to None, which uses the entire volume.\n    raveled : boolean, optional\n        Specifies whether to return the flooded pixels as coordinates or as\n        raveled indices.\n\n    Returns\n    -------\n    matches : ndarray\n        either a 1D array of raveled indices of pixels in im, or a \n        2D ndarray where each row is the coordinates of a pixel.\n    ");
static PyMethodDef __pyx_mdef_4gala_9optimized_3flood_fill = {"flood_fill", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_4gala_9optimized_3flood_fill, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_4gala_9optimized_2flood_fill};
static PyObject *__pyx_pw_4gala_9optimized_3flood_fill(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_im = 0;
  PyObject *__pyx_v_start = 0;
  PyObject *__pyx_v_acceptable = 0;
  PyObject *__pyx_v_limits = 0;
  PyObject *__pyx_v_raveled = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("flood_fill (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_im,&amp;__pyx_n_s_start,&amp;__pyx_n_s_acceptable,&amp;__pyx_n_s_limits,&amp;__pyx_n_s_raveled,0};
  PyObject* values[5] = {0,0,0,0,0};
    values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(((PyObject *)Py_None));
    values[4] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_im)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_start)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, 1); <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_acceptable)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, 2); <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_limits);
          if (value) { values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_raveled);
          if (value) { values[4] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "flood_fill") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_im = values[0];
    __pyx_v_start = values[1];
    __pyx_v_acceptable = values[2];
    __pyx_v_limits = values[3];
    __pyx_v_raveled = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.flood_fill", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4gala_9optimized_2flood_fill(__pyx_self, __pyx_v_im, __pyx_v_start, __pyx_v_acceptable, __pyx_v_limits, __pyx_v_raveled);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4gala_9optimized_2flood_fill(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_im, PyObject *__pyx_v_start, PyObject *__pyx_v_acceptable, PyObject *__pyx_v_limits, PyObject *__pyx_v_raveled) {
  PyArrayObject *__pyx_v_matches = 0;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_s = NULL;
  PyObject *__pyx_v_formatted = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_matches;
  __Pyx_Buffer __pyx_pybuffer_matches;
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limits);
  __pyx_pybuffer_matches.pybuffer.buf = NULL;
  __pyx_pybuffer_matches.refcount = 0;
  __pyx_pybuffernd_matches.data = NULL;
  __pyx_pybuffernd_matches.rcbuffer = &amp;__pyx_pybuffer_matches;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.flood_fill", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_matches);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_formatted);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_limits);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__27 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_im, __pyx_n_s_start, __pyx_n_s_acceptable, __pyx_n_s_limits, __pyx_n_s_raveled, __pyx_n_s_matches, __pyx_n_s_a, __pyx_n_s_s, __pyx_n_s_formatted);<span class='error_goto'> if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 65, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__27);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__27);
  __pyx_codeobj__28 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gala_optimized_pyx, __pyx_n_s_flood_fill, 65, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 65, __pyx_L1_error)</span>
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_4gala_9optimized_3flood_fill, 0, __pyx_n_s_flood_fill, NULL, __pyx_n_s_gala_optimized, __pyx_d, ((PyObject *)__pyx_codeobj__28));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 65, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_7, __pyx_tuple__29);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_flood_fill, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">066</span>:     """ Find all connected points in a 3D volume.</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:     Starting from a given point, this function floods into all adjacent</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     points that have an acceptable label.</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     im : 3D ndarray of longs</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:         This is the volume in which the flood fill will fill. Each voxel's</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:         value is its label and its indices are its position.</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     start : 1D ndarray of longs</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:         This gives the position of the first point from which the flood fill</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:         will begin. must be length 3.</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     acceptable : 1D ndarray of longs</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:         As the flood fills, each pixel is checked to see if its value is in</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:         this list. the flood fill continues into that pixel iff it is.</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     limits : 2D ndarray of longs, optional</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:         Allows the calling function specify an outer bound for the flood fill.</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:         Given as a matrix where each row represents a dimension in im and the</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:         first column is the lower bound and the second column is the upper.</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:         Defaults to None, which uses the entire volume.</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:     raveled : boolean, optional</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:         Specifies whether to return the flooded pixels as coordinates or as</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>:         raveled indices.</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:     matches : ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:         either a 1D array of raveled indices of pixels in im, or a</pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:         2D ndarray where each row is the coordinates of a pixel.</pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>:     cdef np.ndarray[np.int_t, ndim=2] matches</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:     if im.ndim == 3:</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyInt_BoolEqObjC</span>(__pyx_t_1, __pyx_int_3, 3, 0)); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(__pyx_t_2)) {
/* … */
  }
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:         a = np.array(acceptable)</pre>
<pre class='cython code score-19 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 99, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 99, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_acceptable};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_v_a = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:         s = np.array(start)</pre>
<pre class='cython code score-19 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_start};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_s = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>:         if limits == None:</pre>
<pre class='cython code score-8 '>    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_limits, Py_None, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)</span>
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 101, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:             limits = np.array([[0,im.shape[0]-1],[0,im.shape[1]-1],[0,im.shape[2]-1]])</pre>
<pre class='cython code score-86 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractObjC</span>(__pyx_t_6, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_int_0)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractObjC</span>(__pyx_t_7, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 0, __pyx_int_0)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractObjC</span>(__pyx_t_8, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_int_0)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      __pyx_t_3 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>;
      __pyx_t_6 = 0;
      __pyx_t_7 = 0;
      __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_3};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_limits, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:         matches = _flood_fill_3d(im, s, a, limits)</pre>
<pre class='cython code score-28 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_long</span>(__pyx_v_im, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_s, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_a, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_v_limits, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
    __pyx_t_1 = __pyx_f_4gala_9optimized__flood_fill_3d(__pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
    __pyx_t_9.memview = NULL; __pyx_t_9.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_10, 1);
    __pyx_t_10.memview = NULL; __pyx_t_10.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_5 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_15, &amp;__pyx_t_16);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_matches, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_15, __pyx_t_16);
        }
        __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
      }
      __pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
      if (unlikely((__pyx_t_5 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
    }
    __pyx_t_13 = 0;
    __pyx_v_matches = ((PyArrayObject *)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:         if _list_match(a, im[s[0], s[1], s[2]]) == -1:</pre>
<pre class='cython code score-33 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_a, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>;
    __pyx_t_1 = 0;
    __pyx_t_4 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_im, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_4gala_9optimized__list_match(__pyx_t_11, __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
    __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyInt_BoolEqObjC</span>(__pyx_t_3, __pyx_int_neg_1, -1L, 0)); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>:             return np.array([])</pre>
<pre class='cython code score-26 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_1 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_8};
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      }
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">106</span>:         if raveled:</pre>
<pre class='cython code score-2 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_raveled); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L1_error)</span>
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:             formatted = matches.T</pre>
<pre class='cython code score-2 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_matches), __pyx_n_s_T);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_v_formatted = __pyx_t_3;
      __pyx_t_3 = 0;
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">108</span>:             return np.ravel_multi_index(formatted, im.shape)</pre>
<pre class='cython code score-23 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_ravel_multi_index);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_1 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_1, __pyx_v_formatted, __pyx_t_4};
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_8, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      }
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">109</span>:         else:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>:             return matches</pre>
<pre class='cython code score-2 '>    /*else*/ {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_matches);
      __pyx_r = ((PyObject *)__pyx_v_matches);
      goto __pyx_L0;
    }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>:     else: raise ValueError("flood fill volume must be 3d!")</pre>
<pre class='cython code score-10 '>  /*else*/ {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
  }
/* … */
  __pyx_tuple__12 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_flood_fill_volume_must_be_3d);<span class='error_goto'> if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__12);
</pre><pre class="cython line score-0">&#xA0;<span class="">112</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>: cdef inline _row_match(long[:,:] rows, long[:] query, long limit):</pre>
<pre class='cython code score-3 '>static CYTHON_INLINE PyObject *__pyx_f_4gala_9optimized__row_match(__Pyx_memviewslice __pyx_v_rows, __Pyx_memviewslice __pyx_v_query, long __pyx_v_limit) {
  int __pyx_v_rr;
  int __pyx_v_jj;
  int __pyx_v_match;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._row_match", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>:     """ Fast check if the `query` array is a row in `rows`</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:     rows : ndarray, 2 dimensions, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:         Each row represents a unique potential match.</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:     query : ndarray, 1 dimension, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:         The group of numbers we wish to know if appears in `rows`</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:     limit : long</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         Only searches the first `limit` many rows.</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:     rr : long</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:         The row of the first occurence of `query`, or -1 if not found.</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:     cdef int rr, jj, match</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:     for rr in range(limit):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_limit;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_rr = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:         match = 1</pre>
<pre class='cython code score-0 '>    __pyx_v_match = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:         for jj in range(rows.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = (__pyx_v_rows.shape[1]);
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:             if query[jj] != rows[rr,jj]:</pre>
<pre class='cython code score-4 '>      __pyx_t_7 = __pyx_v_jj;
      __pyx_t_8 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_query.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_query.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
      }
      __pyx_t_9 = __pyx_v_rr;
      __pyx_t_10 = __pyx_v_jj;
      __pyx_t_8 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_rows.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_rows.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_rows.shape[1];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rows.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
      }
      __pyx_t_11 = ((*((long *) ( /* dim=0 */ (__pyx_v_query.data + __pyx_t_7 * __pyx_v_query.strides[0]) ))) != (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) ) + __pyx_t_10 * __pyx_v_rows.strides[1]) ))));
      if (__pyx_t_11) {
/* … */
      }
    }
    __pyx_L6_break:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:                 match = 0</pre>
<pre class='cython code score-0 '>        __pyx_v_match = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>:                 break</pre>
<pre class='cython code score-0 '>        goto __pyx_L6_break;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:         if match == 1: return rr</pre>
<pre class='cython code score-3 '>    __pyx_t_11 = (__pyx_v_match == 1);
    if (__pyx_t_11) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_rr);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      __pyx_r = __pyx_t_12;
      __pyx_t_12 = 0;
      goto __pyx_L0;
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">138</span>:     return -1</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  __pyx_r = __pyx_int_neg_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">139</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>: cdef inline _list_match(long[:] vals, long query):</pre>
<pre class='cython code score-3 '>static CYTHON_INLINE PyObject *__pyx_f_4gala_9optimized__list_match(__Pyx_memviewslice __pyx_v_vals, long __pyx_v_query) {
  int __pyx_v_jj;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._list_match", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>:     """ Fast check if a long is in a list of longs</pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:     vals : ndarray, 1 dimension, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:         The list of acceptable values.</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     query : long</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:         The value we wish to know whether is in vals.</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:     jj : long</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:         The index of the first occurence of query in vals,</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:         or -1 if not found.</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:     cdef int jj</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>:     for jj in range(vals.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_vals.shape[0]);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_jj = __pyx_t_3;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:         if vals[jj] == query: return jj</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = __pyx_v_jj;
    __pyx_t_5 = -1;
    if (__pyx_t_4 &lt; 0) {
      __pyx_t_4 += __pyx_v_vals.shape[0];
      if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_vals.shape[0])) __pyx_t_5 = 0;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
    }
    __pyx_t_6 = ((*((long *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_4 * __pyx_v_vals.strides[0]) ))) == __pyx_v_query);
    if (__pyx_t_6) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_jj);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_r = __pyx_t_7;
      __pyx_t_7 = 0;
      goto __pyx_L0;
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:     return -1</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  __pyx_r = __pyx_int_neg_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">160</span>: </pre>
<pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>: cdef _flood_fill_3d(long[:,:,:] im, long[:] start, long[:] acceptable, long[:,:] limits):</pre>
<pre class='cython code score-41 '>static PyObject *__pyx_f_4gala_9optimized__flood_fill_3d(__Pyx_memviewslice __pyx_v_im, __Pyx_memviewslice __pyx_v_start, __Pyx_memviewslice __pyx_v_acceptable, __Pyx_memviewslice __pyx_v_limits) {
  int __pyx_v_frontier_size;
  int __pyx_v_matches_size;
  int __pyx_v_starting_size;
  int __pyx_v_ndim;
  int __pyx_v_base_point_ii;
  int __pyx_v_p_ii;
  int __pyx_v_new_frontier_size;
  int __pyx_v_jj;
  PyArrayObject *__pyx_v_adjacent = 0;
  PyArrayObject *__pyx_v_matches = 0;
  PyArrayObject *__pyx_v_frontier = 0;
  PyArrayObject *__pyx_v_new_frontier = 0;
  PyArrayObject *__pyx_v_base_point = 0;
  PyArrayObject *__pyx_v_p = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_adjacent;
  __Pyx_Buffer __pyx_pybuffer_adjacent;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_base_point;
  __Pyx_Buffer __pyx_pybuffer_base_point;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_frontier;
  __Pyx_Buffer __pyx_pybuffer_frontier;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_matches;
  __Pyx_Buffer __pyx_pybuffer_matches;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_new_frontier;
  __Pyx_Buffer __pyx_pybuffer_new_frontier;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_p;
  __Pyx_Buffer __pyx_pybuffer_p;
  PyObject *__pyx_r = NULL;
  __pyx_pybuffer_adjacent.pybuffer.buf = NULL;
  __pyx_pybuffer_adjacent.refcount = 0;
  __pyx_pybuffernd_adjacent.data = NULL;
  __pyx_pybuffernd_adjacent.rcbuffer = &amp;__pyx_pybuffer_adjacent;
  __pyx_pybuffer_matches.pybuffer.buf = NULL;
  __pyx_pybuffer_matches.refcount = 0;
  __pyx_pybuffernd_matches.data = NULL;
  __pyx_pybuffernd_matches.rcbuffer = &amp;__pyx_pybuffer_matches;
  __pyx_pybuffer_frontier.pybuffer.buf = NULL;
  __pyx_pybuffer_frontier.refcount = 0;
  __pyx_pybuffernd_frontier.data = NULL;
  __pyx_pybuffernd_frontier.rcbuffer = &amp;__pyx_pybuffer_frontier;
  __pyx_pybuffer_new_frontier.pybuffer.buf = NULL;
  __pyx_pybuffer_new_frontier.refcount = 0;
  __pyx_pybuffernd_new_frontier.data = NULL;
  __pyx_pybuffernd_new_frontier.rcbuffer = &amp;__pyx_pybuffer_new_frontier;
  __pyx_pybuffer_base_point.pybuffer.buf = NULL;
  __pyx_pybuffer_base_point.refcount = 0;
  __pyx_pybuffernd_base_point.data = NULL;
  __pyx_pybuffernd_base_point.rcbuffer = &amp;__pyx_pybuffer_base_point;
  __pyx_pybuffer_p.pybuffer.buf = NULL;
  __pyx_pybuffer_p.refcount = 0;
  __pyx_pybuffernd_p.data = NULL;
  __pyx_pybuffernd_p.rcbuffer = &amp;__pyx_pybuffer_p;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_21, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_26, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._flood_fill_3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_adjacent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_matches);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_frontier);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_new_frontier);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_base_point);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_p);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">162</span>:     """ Workhorse function for flood_fill, see its documentation.</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     Assumes im[start] is in acceptable and start is within limits. """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:     cdef int frontier_size = 1</pre>
<pre class='cython code score-0 '>  __pyx_v_frontier_size = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:     cdef int matches_size = 1</pre>
<pre class='cython code score-0 '>  __pyx_v_matches_size = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:     cdef int starting_size = 5000</pre>
<pre class='cython code score-0 '>  __pyx_v_starting_size = 0x1388;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:     cdef int ndim = im.ndim</pre>
<pre class='cython code score-11 '>  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_im, 3, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 167, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ndim = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">168</span>:     cdef int in_matches, in_acceptable, base_point_ii, p_ii, new_frontier_size, jj</pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:     cdef np.ndarray[np.int_t, ndim=2] adjacent</pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:     cdef np.ndarray[np.int_t, ndim=2] matches =      np.zeros([starting_size, ndim], dtype=np.int)</pre>
<pre class='cython code score-48 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_matches = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_matches = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:     cdef np.ndarray[np.int_t, ndim=2] frontier =     np.empty([starting_size, ndim], dtype=np.int)</pre>
<pre class='cython code score-48 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>;
  __pyx_t_6 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_frontier = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_frontier.diminfo[0].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_frontier.diminfo[0].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_frontier.diminfo[1].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_frontier.diminfo[1].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_frontier = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:     cdef np.ndarray[np.int_t, ndim=2] new_frontier = np.empty([starting_size, ndim], dtype=np.int)</pre>
<pre class='cython code score-48 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_new_frontier = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_new_frontier.diminfo[0].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new_frontier.diminfo[0].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_new_frontier.diminfo[1].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_new_frontier.diminfo[1].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_new_frontier = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">173</span>:     cdef np.ndarray[np.int_t, ndim=1] base_point, p</pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>:     for jj in range(ndim):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_ndim;
  __pyx_t_10 = __pyx_t_3;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_jj = __pyx_t_11;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:         frontier[0,jj] = start[jj]</pre>
<pre class='cython code score-4 '>    __pyx_t_12 = __pyx_v_jj;
    __pyx_t_13 = -1;
    if (__pyx_t_12 &lt; 0) {
      __pyx_t_12 += __pyx_v_start.shape[0];
      if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_13 = 0;
    } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_start.shape[0])) __pyx_t_13 = 0;
    if (unlikely(__pyx_t_13 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
      <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
    }
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_jj;
    __pyx_t_13 = -1;
    if (__pyx_t_14 &lt; 0) {
      __pyx_t_14 += __pyx_pybuffernd_frontier.diminfo[0].shape;
      if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_13 = 0;
    } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_frontier.diminfo[0].shape)) __pyx_t_13 = 0;
    if (__pyx_t_15 &lt; 0) {
      __pyx_t_15 += __pyx_pybuffernd_frontier.diminfo[1].shape;
      if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_13 = 1;
    } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_frontier.diminfo[1].shape)) __pyx_t_13 = 1;
    if (unlikely(__pyx_t_13 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
      <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
    }
    *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_frontier.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_frontier.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_start.data + __pyx_t_12 * __pyx_v_start.strides[0]) )));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:         matches[0,jj] = start[jj]</pre>
<pre class='cython code score-4 '>    __pyx_t_12 = __pyx_v_jj;
    __pyx_t_13 = -1;
    if (__pyx_t_12 &lt; 0) {
      __pyx_t_12 += __pyx_v_start.shape[0];
      if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_13 = 0;
    } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_start.shape[0])) __pyx_t_13 = 0;
    if (unlikely(__pyx_t_13 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
      <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
    }
    __pyx_t_15 = 0;
    __pyx_t_14 = __pyx_v_jj;
    __pyx_t_13 = -1;
    if (__pyx_t_15 &lt; 0) {
      __pyx_t_15 += __pyx_pybuffernd_matches.diminfo[0].shape;
      if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_13 = 0;
    } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_matches.diminfo[0].shape)) __pyx_t_13 = 0;
    if (__pyx_t_14 &lt; 0) {
      __pyx_t_14 += __pyx_pybuffernd_matches.diminfo[1].shape;
      if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_13 = 1;
    } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_matches.diminfo[1].shape)) __pyx_t_13 = 1;
    if (unlikely(__pyx_t_13 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
      <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
    }
    *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_matches.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_matches.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_start.data + __pyx_t_12 * __pyx_v_start.strides[0]) )));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:     while frontier_size &gt; 0:</pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_16 = (__pyx_v_frontier_size &gt; 0);
    if (!__pyx_t_16) break;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>:         new_frontier_size = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_new_frontier_size = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>:         for base_point_ii in range(frontier_size):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_frontier_size;
    __pyx_t_10 = __pyx_t_3;
    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_base_point_ii = __pyx_t_11;
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">181</span>:             base_point = frontier[base_point_ii]</pre>
<pre class='cython code score-23 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_frontier), __pyx_v_base_point_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>
      __pyx_t_17 = ((PyArrayObject *)__pyx_t_6);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_13 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_18, &amp;__pyx_t_19, &amp;__pyx_t_20);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_base_point, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_18, __pyx_t_19, __pyx_t_20);
          }
          __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
        }
        __pyx_pybuffernd_base_point.diminfo[0].strides = __pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_base_point.diminfo[0].shape = __pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely((__pyx_t_13 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>
      }
      __pyx_t_17 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_base_point, ((PyArrayObject *)__pyx_t_6));
      __pyx_t_6 = 0;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:             adjacent = _adjacent_points(base_point, limits)</pre>
<pre class='cython code score-21 '>      __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_base_point), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      __pyx_t_6 = ((PyObject *)__pyx_f_4gala_9optimized__adjacent_points(__pyx_t_21, __pyx_v_limits));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_21, 1);
      __pyx_t_21.memview = NULL; __pyx_t_21.data = NULL;
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_6), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
        if (unlikely(__pyx_t_13 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_19, &amp;__pyx_t_18);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_adjacent, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_19, __pyx_t_18);
          }
          __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
        }
        __pyx_pybuffernd_adjacent.diminfo[0].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_adjacent.diminfo[0].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_adjacent.diminfo[1].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_adjacent.diminfo[1].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[1];
        if (unlikely((__pyx_t_13 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_adjacent, ((PyArrayObject *)__pyx_t_6));
      __pyx_t_6 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>:             for p_ii in range(adjacent.shape[0]):</pre>
<pre class='cython code score-5 '>      __pyx_t_22 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_adjacent)); if (unlikely(__pyx_t_22 == ((npy_intp *)NULL) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 183, __pyx_L1_error)</span>
      __pyx_t_23 = (__pyx_t_22[0]);
      __pyx_t_24 = __pyx_t_23;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_24; __pyx_t_13+=1) {
        __pyx_v_p_ii = __pyx_t_13;
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:                 p = adjacent[p_ii]</pre>
<pre class='cython code score-23 '>        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_adjacent), __pyx_v_p_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 184, __pyx_L1_error)</span>
        __pyx_t_17 = ((PyArrayObject *)__pyx_t_6);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
          __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
          if (unlikely(__pyx_t_25 &lt; 0)) {
            <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_18, &amp;__pyx_t_19, &amp;__pyx_t_20);
            if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_p, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
            } else {
              <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_p.diminfo[0].strides = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_p.diminfo[0].shape = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.shape[0];
          if (unlikely((__pyx_t_25 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 184, __pyx_L1_error)</span>
        }
        __pyx_t_17 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_p, ((PyArrayObject *)__pyx_t_6));
        __pyx_t_6 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:                 if _list_match(p, -1) != -1:</pre>
<pre class='cython code score-5 '>        __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_p), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
        __pyx_t_6 = __pyx_f_4gala_9optimized__list_match(__pyx_t_21, -1L);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_21, 1);
        __pyx_t_21.memview = NULL; __pyx_t_21.data = NULL;
        __pyx_t_16 = (<span class='pyx_c_api'>__Pyx_PyInt_BoolNeObjC</span>(__pyx_t_6, __pyx_int_neg_1, -1L, 0)); if (unlikely((__pyx_t_16 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_16) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L9_continue;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:                 if _row_match(matches, p, matches_size) &gt; -1:</pre>
<pre class='cython code score-13 '>        __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_matches), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
        __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_p), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
        __pyx_t_6 = __pyx_f_4gala_9optimized__row_match(__pyx_t_26, __pyx_t_21, __pyx_v_matches_size);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_26, 1);
        __pyx_t_26.memview = NULL; __pyx_t_26.data = NULL;
        __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_21, 1);
        __pyx_t_21.memview = NULL; __pyx_t_21.data = NULL;
        __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_6, __pyx_int_neg_1, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5); if (unlikely((__pyx_t_16 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_16) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L9_continue;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:                 if _list_match(acceptable, im[p[0],p[1],p[2]]) == -1:</pre>
<pre class='cython code score-11 '>        __pyx_t_12 = 0;
        __pyx_t_25 = -1;
        if (__pyx_t_12 &lt; 0) {
          __pyx_t_12 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
        }
        __pyx_t_14 = 1;
        __pyx_t_25 = -1;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
        }
        __pyx_t_15 = 2;
        __pyx_t_25 = -1;
        if (__pyx_t_15 &lt; 0) {
          __pyx_t_15 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
        }
        __pyx_t_27 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_28 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_29 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_25 = -1;
        if (__pyx_t_27 &lt; 0) {
          __pyx_t_27 += __pyx_v_im.shape[0];
          if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_27 &gt;= __pyx_v_im.shape[0])) __pyx_t_25 = 0;
        if (__pyx_t_28 &lt; 0) {
          __pyx_t_28 += __pyx_v_im.shape[1];
          if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_25 = 1;
        } else if (unlikely(__pyx_t_28 &gt;= __pyx_v_im.shape[1])) __pyx_t_25 = 1;
        if (__pyx_t_29 &lt; 0) {
          __pyx_t_29 += __pyx_v_im.shape[2];
          if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_25 = 2;
        } else if (unlikely(__pyx_t_29 &gt;= __pyx_v_im.shape[2])) __pyx_t_25 = 2;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
        }
        __pyx_t_5 = __pyx_f_4gala_9optimized__list_match(__pyx_v_acceptable, (*((long *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_im.data + __pyx_t_27 * __pyx_v_im.strides[0]) ) + __pyx_t_28 * __pyx_v_im.strides[1]) ) + __pyx_t_29 * __pyx_v_im.strides[2]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_16 = (<span class='pyx_c_api'>__Pyx_PyInt_BoolEqObjC</span>(__pyx_t_5, __pyx_int_neg_1, -1L, 0)); if (unlikely((__pyx_t_16 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_16) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L9_continue;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:                 new_frontier[new_frontier_size] = p</pre>
<pre class='cython code score-2 '>        if (unlikely((<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_new_frontier), __pyx_v_new_frontier_size, ((PyObject *)__pyx_v_p), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 191, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:                 matches[matches_size] = p</pre>
<pre class='cython code score-2 '>        if (unlikely((<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_matches), __pyx_v_matches_size, ((PyObject *)__pyx_v_p), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 192, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:                 matches_size += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_matches_size = (__pyx_v_matches_size + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:                 new_frontier_size += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_new_frontier_size = (__pyx_v_new_frontier_size + 1);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:                 if matches_size &gt;= matches.shape[0]:</pre>
<pre class='cython code score-5 '>        __pyx_t_22 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_matches)); if (unlikely(__pyx_t_22 == ((npy_intp *)NULL) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>
        __pyx_t_16 = (__pyx_v_matches_size &gt;= (__pyx_t_22[0]));
        if (__pyx_t_16) {
/* … */
        }
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:                     matches = _expand_2darray(matches)</pre>
<pre class='cython code score-21 '>          __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_matches), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_26));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_26, 1);
          __pyx_t_26.memview = NULL; __pyx_t_26.data = NULL;
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_19, &amp;__pyx_t_18);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_matches, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely((__pyx_t_25 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 196, __pyx_L1_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_matches, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:                 if new_frontier_size &gt;= new_frontier.shape[0]:</pre>
<pre class='cython code score-5 '>        __pyx_t_22 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_new_frontier)); if (unlikely(__pyx_t_22 == ((npy_intp *)NULL) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 197, __pyx_L1_error)</span>
        __pyx_t_16 = (__pyx_v_new_frontier_size &gt;= (__pyx_t_22[0]));
        if (__pyx_t_16) {
/* … */
        }
        __pyx_L9_continue:;
      }
    }
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:                     new_frontier = _expand_2darray(new_frontier)</pre>
<pre class='cython code score-21 '>          __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_new_frontier), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_26));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_26, 1);
          __pyx_t_26.memview = NULL; __pyx_t_26.data = NULL;
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_18, &amp;__pyx_t_19, &amp;__pyx_t_20);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new_frontier, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_new_frontier.diminfo[0].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new_frontier.diminfo[0].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_new_frontier.diminfo[1].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_new_frontier.diminfo[1].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely((__pyx_t_25 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 198, __pyx_L1_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_new_frontier, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>:                     frontier = _expand_2darray(frontier)</pre>
<pre class='cython code score-21 '>          __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_frontier), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 199, __pyx_L1_error)</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_26));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 199, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_26, 1);
          __pyx_t_26.memview = NULL; __pyx_t_26.data = NULL;
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_19, &amp;__pyx_t_18);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_frontier, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_frontier.diminfo[0].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_frontier.diminfo[0].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_frontier.diminfo[1].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_frontier.diminfo[1].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely((__pyx_t_25 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_frontier, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:         for p_ii in range(new_frontier_size):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_new_frontier_size;
    __pyx_t_10 = __pyx_t_3;
    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_p_ii = __pyx_t_11;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:             for jj in range(new_frontier.shape[1]):</pre>
<pre class='cython code score-5 '>      __pyx_t_22 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_new_frontier)); if (unlikely(__pyx_t_22 == ((npy_intp *)NULL) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 201, __pyx_L1_error)</span>
      __pyx_t_23 = (__pyx_t_22[1]);
      __pyx_t_24 = __pyx_t_23;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_24; __pyx_t_13+=1) {
        __pyx_v_jj = __pyx_t_13;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:                 frontier[p_ii,jj] = new_frontier[p_ii, jj]</pre>
<pre class='cython code score-4 '>        __pyx_t_15 = __pyx_v_p_ii;
        __pyx_t_14 = __pyx_v_jj;
        __pyx_t_25 = -1;
        if (__pyx_t_15 &lt; 0) {
          __pyx_t_15 += __pyx_pybuffernd_new_frontier.diminfo[0].shape;
          if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_new_frontier.diminfo[0].shape)) __pyx_t_25 = 0;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_pybuffernd_new_frontier.diminfo[1].shape;
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_25 = 1;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_new_frontier.diminfo[1].shape)) __pyx_t_25 = 1;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
        }
        __pyx_t_12 = __pyx_v_p_ii;
        __pyx_t_29 = __pyx_v_jj;
        __pyx_t_25 = -1;
        if (__pyx_t_12 &lt; 0) {
          __pyx_t_12 += __pyx_pybuffernd_frontier.diminfo[0].shape;
          if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_frontier.diminfo[0].shape)) __pyx_t_25 = 0;
        if (__pyx_t_29 &lt; 0) {
          __pyx_t_29 += __pyx_pybuffernd_frontier.diminfo[1].shape;
          if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_25 = 1;
        } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_frontier.diminfo[1].shape)) __pyx_t_25 = 1;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
        }
        *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_frontier.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_frontier.diminfo[1].strides) = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_new_frontier.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_new_frontier.diminfo[1].strides));
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:         frontier_size = new_frontier_size</pre>
<pre class='cython code score-0 '>    __pyx_v_frontier_size = __pyx_v_new_frontier_size;
  }
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:     return matches[0:matches_size, :]</pre>
<pre class='cython code score-22 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_matches_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_5, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>;
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_matches), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>: cdef np.ndarray[np.int_t, ndim=2] _expand_2darray(long[:,:] a):</pre>
<pre class='cython code score-16 '>static PyArrayObject *__pyx_f_4gala_9optimized__expand_2darray(__Pyx_memviewslice __pyx_v_a) {
  int __pyx_v_ii;
  int __pyx_v_jj;
  PyArrayObject *__pyx_v_expanded = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_expanded;
  __Pyx_Buffer __pyx_pybuffer_expanded;
  PyArrayObject *__pyx_r = NULL;
  __pyx_pybuffer_expanded.pybuffer.buf = NULL;
  __pyx_pybuffer_expanded.refcount = 0;
  __pyx_pybuffernd_expanded.data = NULL;
  __pyx_pybuffernd_expanded.rcbuffer = &amp;__pyx_pybuffer_expanded;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._expand_2darray", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_expanded);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>:     """ Double the number of rows in a matrix and copy over the existing values</pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>:     cdef int ii,jj</pre>
<pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:     cdef np.ndarray[np.int_t, ndim=2] expanded = np.zeros([a.shape[0] * 2, a.shape[1]], dtype=np.int)</pre>
<pre class='cython code score-54 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((__pyx_v_a.shape[0]) * 2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_a.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_expanded = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_expanded.diminfo[0].strides = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_expanded.diminfo[0].shape = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_expanded.diminfo[1].strides = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_expanded.diminfo[1].shape = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_expanded = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>:     for ii in range(a.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_a.shape[0]);
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_ii = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:         for jj in range(a.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = (__pyx_v_a.shape[1]);
    __pyx_t_11 = __pyx_t_10;
    for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_jj = __pyx_t_12;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:             expanded[ii,jj] = a[ii,jj]</pre>
<pre class='cython code score-4 '>      __pyx_t_13 = __pyx_v_ii;
      __pyx_t_14 = __pyx_v_jj;
      __pyx_t_15 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_a.shape[0];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_a.shape[0])) __pyx_t_15 = 0;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_a.shape[1];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 1;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_a.shape[1])) __pyx_t_15 = 1;
      if (unlikely(__pyx_t_15 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
        <span class='error_goto'>__PYX_ERR(0, 214, __pyx_L1_error)</span>
      }
      __pyx_t_16 = __pyx_v_ii;
      __pyx_t_17 = __pyx_v_jj;
      __pyx_t_15 = -1;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_pybuffernd_expanded.diminfo[0].shape;
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_expanded.diminfo[0].shape)) __pyx_t_15 = 0;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_pybuffernd_expanded.diminfo[1].shape;
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_15 = 1;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_expanded.diminfo[1].shape)) __pyx_t_15 = 1;
      if (unlikely(__pyx_t_15 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
        <span class='error_goto'>__PYX_ERR(0, 214, __pyx_L1_error)</span>
      }
      *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_expanded.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_expanded.diminfo[1].strides) = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_a.data + __pyx_t_13 * __pyx_v_a.strides[0]) ) + __pyx_t_14 * __pyx_v_a.strides[1]) )));
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>:     return expanded</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_expanded);
  __pyx_r = ((PyArrayObject *)__pyx_v_expanded);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">216</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>: cdef np.ndarray[np.int_t, ndim=2] _adjacent_points(long[:] point, long[:,:] limits):</pre>
<pre class='cython code score-16 '>static PyArrayObject *__pyx_f_4gala_9optimized__adjacent_points(__Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_limits) {
  int __pyx_v_dimensions;
  int __pyx_v_variants;
  int __pyx_v_v;
  int __pyx_v_d;
  int __pyx_v_s;
  int __pyx_v_new;
  int __pyx_v_ii;
  int __pyx_v_shifts[2];
  PyArrayObject *__pyx_v_adjacent = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_adjacent;
  __Pyx_Buffer __pyx_pybuffer_adjacent;
  PyArrayObject *__pyx_r = NULL;
  __pyx_pybuffer_adjacent.pybuffer.buf = NULL;
  __pyx_pybuffer_adjacent.refcount = 0;
  __pyx_pybuffernd_adjacent.data = NULL;
  __pyx_pybuffernd_adjacent.rcbuffer = &amp;__pyx_pybuffer_adjacent;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._adjacent_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_adjacent);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">219</span>:     """ Get all adjacent points to point that fall within limits.</pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>:     point : ndarray, 1 dimension, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>:         the coordinates of an n-dimensional point</pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>:     limits : ndarray, 2 dimensions, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>:         point.shape[0] rows, 2 columns, each row of this array represents the</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:         lower and upper (inclusive) bounds of acceptable values for</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:         points that are returned.</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>:     adjacent : ndarray, 2 dimensions, type long</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:         2 rows for each "dimension" of point, one column for each dimension</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>:         Each row represents an adjacent points to `point`. Invalid points are</pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:         left as -1 across all columns.</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:     """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:     cdef int dimensions = point.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_dimensions = (__pyx_v_point.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:     cdef int variants = dimensions * 2</pre>
<pre class='cython code score-0 '>  __pyx_v_variants = (__pyx_v_dimensions * 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:     cdef int v = -1</pre>
<pre class='cython code score-0 '>  __pyx_v_v = -1;
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>:     cdef int d, s, new,ii</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:     cdef int[2] shifts</pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:     cdef np.ndarray[np.int_t, ndim=2] adjacent = np.ones([variants, dimensions], dtype=np.int)*-1</pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_variants);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_dimensions);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_MultiplyObjC</span>(__pyx_t_5, __pyx_int_neg_1, -1L, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_adjacent = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_adjacent.diminfo[0].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_adjacent.diminfo[0].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_adjacent.diminfo[1].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_adjacent.diminfo[1].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_adjacent = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:     shifts[0] = -1</pre>
<pre class='cython code score-0 '>  (__pyx_v_shifts[0]) = -1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:     shifts[1] = 1</pre>
<pre class='cython code score-0 '>  (__pyx_v_shifts[1]) = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:     for d in range(dimensions):</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_dimensions;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_d = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:         for s in shifts:</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (__pyx_v_shifts + 2);
    for (__pyx_t_12 = __pyx_v_shifts; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12++) {
      __pyx_t_10 = __pyx_t_12;
      __pyx_v_s = (__pyx_t_10[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:             v += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_v = (__pyx_v_v + 1);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:             new = point[d] + s</pre>
<pre class='cython code score-2 '>      __pyx_t_13 = __pyx_v_d;
      __pyx_t_14 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_point.shape[0];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_point.shape[0])) __pyx_t_14 = 0;
      if (unlikely(__pyx_t_14 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
        <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>
      }
      __pyx_v_new = ((*((long *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_13 * __pyx_v_point.strides[0]) ))) + __pyx_v_s);
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:             if new &lt; limits[d,0] or new &gt; limits[d,1]:</pre>
<pre class='cython code score-4 '>      __pyx_t_13 = __pyx_v_d;
      __pyx_t_16 = 0;
      __pyx_t_14 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_limits.shape[0];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_limits.shape[0])) __pyx_t_14 = 0;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_v_limits.shape[1];
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_14 = 1;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_limits.shape[1])) __pyx_t_14 = 1;
      if (unlikely(__pyx_t_14 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
        <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
      }
      __pyx_t_17 = (__pyx_v_new &lt; (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_limits.data + __pyx_t_13 * __pyx_v_limits.strides[0]) ) + __pyx_t_16 * __pyx_v_limits.strides[1]) ))));
      if (!__pyx_t_17) {
      } else {
        __pyx_t_15 = __pyx_t_17;
        goto __pyx_L8_bool_binop_done;
      }
      __pyx_t_16 = __pyx_v_d;
      __pyx_t_13 = 1;
      __pyx_t_14 = -1;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_v_limits.shape[0];
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_14 = 0;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_limits.shape[0])) __pyx_t_14 = 0;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_limits.shape[1];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 1;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_limits.shape[1])) __pyx_t_14 = 1;
      if (unlikely(__pyx_t_14 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
        <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
      }
      __pyx_t_17 = (__pyx_v_new &gt; (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_limits.data + __pyx_t_16 * __pyx_v_limits.strides[0]) ) + __pyx_t_13 * __pyx_v_limits.strides[1]) ))));
      __pyx_t_15 = __pyx_t_17;
      __pyx_L8_bool_binop_done:;
      if (__pyx_t_15) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:                 continue</pre>
<pre class='cython code score-0 '>        goto __pyx_L5_continue;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:             for ii in range(dimensions):</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_dimensions;
      __pyx_t_18 = __pyx_t_14;
      for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
        __pyx_v_ii = __pyx_t_19;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:                 adjacent[v,ii] = point[ii]</pre>
<pre class='cython code score-4 '>        __pyx_t_13 = __pyx_v_ii;
        __pyx_t_20 = -1;
        if (__pyx_t_13 &lt; 0) {
          __pyx_t_13 += __pyx_v_point.shape[0];
          if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_20 = 0;
        } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_point.shape[0])) __pyx_t_20 = 0;
        if (unlikely(__pyx_t_20 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_20);
          <span class='error_goto'>__PYX_ERR(0, 252, __pyx_L1_error)</span>
        }
        __pyx_t_16 = __pyx_v_v;
        __pyx_t_21 = __pyx_v_ii;
        __pyx_t_20 = -1;
        if (__pyx_t_16 &lt; 0) {
          __pyx_t_16 += __pyx_pybuffernd_adjacent.diminfo[0].shape;
          if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_20 = 0;
        } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_adjacent.diminfo[0].shape)) __pyx_t_20 = 0;
        if (__pyx_t_21 &lt; 0) {
          __pyx_t_21 += __pyx_pybuffernd_adjacent.diminfo[1].shape;
          if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_20 = 1;
        } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_adjacent.diminfo[1].shape)) __pyx_t_20 = 1;
        if (unlikely(__pyx_t_20 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_20);
          <span class='error_goto'>__PYX_ERR(0, 252, __pyx_L1_error)</span>
        }
        *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_adjacent.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_adjacent.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_13 * __pyx_v_point.strides[0]) )));
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:             adjacent[v, d] = new</pre>
<pre class='cython code score-2 '>      __pyx_t_13 = __pyx_v_v;
      __pyx_t_21 = __pyx_v_d;
      __pyx_t_14 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_pybuffernd_adjacent.diminfo[0].shape;
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_adjacent.diminfo[0].shape)) __pyx_t_14 = 0;
      if (__pyx_t_21 &lt; 0) {
        __pyx_t_21 += __pyx_pybuffernd_adjacent.diminfo[1].shape;
        if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_14 = 1;
      } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_adjacent.diminfo[1].shape)) __pyx_t_14 = 1;
      if (unlikely(__pyx_t_14 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
        <span class='error_goto'>__PYX_ERR(0, 253, __pyx_L1_error)</span>
      }
      *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_adjacent.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_adjacent.diminfo[1].strides) = __pyx_v_new;
      __pyx_L5_continue:;
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:     return adjacent</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_adjacent);
  __pyx_r = ((PyArrayObject *)__pyx_v_adjacent);
  goto __pyx_L0;
</pre></div></body></html>
